<app-back-nav></app-back-nav>
<ng-container>
  <div id="recipes-header">
    <h1>{{isEdit? "Редактировать рецепт" : "Добавить новый рецепт"}}</h1>
    <button mat-flat-button color="accent" id="publish-recipe-button" type='submit' (click)="publish()">
      {{isEdit ? "Внести изменения": "Опубликовать"}}
    </button>
  </div>

  <form [formGroup]="recipeForm">
    <div id="primary-block">
      <div id="image-block" *ngIf="image == null; else imageUploaded">
        <button mat-button id="input-div-clickable-wrapper" (click)="fileUpload.click()">
          <input required type="file" class="file-input" [accept]="acceptImageTypes" (change)="onFileSelected($event)" #fileUpload>
          <span id="input-div">
        <mat-icon id="upload-icon">cloud_download</mat-icon>
        <span id="upload-text">Загрузите фото готового блюда</span>
      </span>
        </button>
      </div>

      <ng-template #imageUploaded>
        <div id="uploaded-image-block">
          <img id="uploaded-image" [src]="image" alt="preview">
          <button mat-icon-button class="close-icon" (click)="deleteImage()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </ng-template>


      <div id="primary-recipe-info">
        <div class="input-block-with-margin">
          <mat-form-field class="wide-mat-form-field">
            <mat-label>Название рецепта</mat-label>
            <input required type="text" matInput [formControl]="recipeName">
          </mat-form-field>
        </div>

        <div class="input-block-with-margin">
          <mat-form-field id="recipe-description">
            <mat-label>Краткое описание рецепта (150 символов)</mat-label>
            <textarea autosize [rows]="4" [maxRows]="4" matInput [formControl]="recipeDescription"></textarea>
          </mat-form-field>
        </div>

        <div id="cooking-portions-line">
          <mat-form-field class="line-form-field">
            <mat-label>Время готовки</mat-label>
            <input type="number" matInput [formControl]="cookingTime">
          </mat-form-field>
          <span>Минут</span>

          <mat-form-field id="second-mat-form-field" class="line-form-field">
            <mat-label>Порций в блюде</mat-label>
            <input type="number" matInput [formControl]="portions">
          </mat-form-field>
          <span>Персон</span>
        </div>
      </div>
    </div>

    <div id="bottom-blocks">
      <div id="first-bottom-block">
        <h2>Ингредиенты</h2>
        <div formArrayName="ingredients" class="ingredient-block" *ngFor="let _ of ingredients.controls; let i = index">
          <ng-container [formGroupName]="i">
            <mat-form-field class="wide-mat-form-field ingredient-header">
              <mat-label>Заголовок для ингредиентов</mat-label>
              <input type="text" formControlName="header" matInput>
            </mat-form-field>

            <mat-form-field class="ingredient-value">
              <mat-label>Список продуктов для категории</mat-label>
              <textarea autosize [minRows]="4" [maxRows]="10" matInput formControlName="value"></textarea>
            </mat-form-field>

            <button mat-icon-button class="close-icon close-ingredient-icon" (click)="deleteIngredient(i)">
              <mat-icon>close</mat-icon>
            </button>
          </ng-container>
        </div>


        <button mat-stroked-button color="accent" class="add-item-button" (click)="addIngredient()" type='button'>
          <mat-icon>add</mat-icon>
          <span>Добавить заголовок</span>
        </button>
      </div>
      <div id="second-bottom-block">
        <div formArrayName="steps" class="step" *ngFor="let _ of steps.controls; let i = index">
          <ng-container [formGroupName]="i">
            <h3 class="step-header">Шаг {{i+1}}</h3>
            <mat-form-field class="step-value">
              <mat-label>Описание шага</mat-label>
              <textarea autosize [minRows]="3" [maxRows]="10" formControlName="value" matInput></textarea>
            </mat-form-field>
            <button mat-icon-button class="close-icon close-step-icon" (click)="deleteStep(i)">
              <mat-icon>close</mat-icon>
            </button>
          </ng-container>
        </div>

        <div id="add-step-wrapper">
          <button mat-stroked-button color="accent" class="add-item-button" (click)="addStep()" type='button'>
            <mat-icon>add</mat-icon>
            <span>Добавить шаг</span>
          </button>
        </div>
      </div>
    </div>
  </form>

</ng-container>
